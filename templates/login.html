{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center align-items-center mt-5 animate__animated animate__fadeIn">
    <div class="col-md-5">
        <div class="glass-card p-5 bg-white shadow-lg text-center" style="border-radius: 30px; border: 1px solid rgba(255,107,0,0.1);">
            <div class="mb-4">
                <div class="d-inline-block p-4 rounded-circle bg-light mb-3">
                    <i class="fas fa-shopping-bag fa-3x text-orange"></i>
                </div>
            </div>

            <h2 class="fw-bold mb-2">Offranel Shop üçä</h2>
            <p class="text-muted mb-4">Rejoignez notre communaut√© pour acc√©der aux meilleurs articles certifi√©s.</p>

            <div class="alert alert-info py-2 rounded-pill border-0 small mb-4" style="background-color: rgba(24, 119, 242, 0.1); color: #1877F2;">
                <i class="fas fa-shield-alt me-2"></i> Connexion s√©curis√©e via Google
            </div>

            <button id="googleBtn" class="btn btn-dark w-100 py-3 rounded-pill fw-bold shadow-sm d-flex align-items-center justify-content-center transition-all">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" class="me-3">
                Continuer avec Google
            </button>

            <div class="mt-4 pt-3 border-top">
                <p class="small text-muted mb-0">En vous connectant, vous acceptez nos</p>
                <a href="/a-propos" class="small text-orange text-decoration-none fw-bold">Conditions d'utilisation</a>
            </div>
        </div>

        <div class="row mt-4 text-center g-3">
            <div class="col-4">
                <i class="fas fa-check-circle text-orange mb-1"></i>
                <p class="small text-muted" style="font-size: 0.7rem;">Articles Certifi√©s</p>
            </div>
            <div class="col-4">
                <i class="fas fa-truck text-orange mb-1"></i>
                <p class="small text-muted" style="font-size: 0.7rem;">Suivi WhatsApp</p>
            </div>
            <div class="col-4">
                <i class="fas fa-lock text-orange mb-1"></i>
                <p class="small text-muted" style="font-size: 0.7rem;">S√©curit√© Totale</p>
            </div>
        </div>
    </div>
</div>

<div id="authLoader" class="d-none position-fixed top-0 start-0 w-100 h-100 d-flex flex-column justify-content-center align-items-center bg-white opacity-75" style="z-index: 9999;">
    <div class="spinner-border text-orange" role="status"></div>
    <p class="mt-3 fw-bold text-orange">V√©rification de votre compte...</p>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDp2Wbtj_pUEmeH6B7DKQlOAzaW00jr1dE",
    authDomain: "malaki-offranel.firebaseapp.com",
    projectId: "malaki-offranel",
    storageBucket: "malaki-offranel.firebasestorage.app",
    appId: "1:255909746580:web:5b97ab8194520bf783a181"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  document.getElementById('googleBtn').onclick = async () => {
    const loader = document.getElementById('authLoader');
    loader.classList.remove('d-none');

    try {
        const result = await signInWithPopup(auth, provider);
        const response = await fetch('/set_session', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                uid: result.user.uid,
                name: result.user.displayName,
                email: result.user.email,
                photo: result.user.photoURL
            })
        });

        if(response.ok) {
            window.location.href = "/";
        }
    } catch (e) {
        loader.classList.add('d-none');
        alert("Erreur de connexion : " + e.message);
    }
  };
</script>

<style>
    .text-orange { color: #FF6B00 !important; }
    .bg-orange { background-color: #FF6B00 !important; }
    .btn-dark:hover { background-color: #333; transform: translateY(-2px); }
    .transition-all { transition: all 0.3s ease; }
    .glass-card { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.95); }
</style>
{% endblock %}