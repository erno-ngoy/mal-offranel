{% extends 'base.html' %}

{% block content %}
<!-- SEO visible pour Google -->
<section class="container mt-3">
    <h1 class="visually-hidden">
        Connexion Offranel Shop ‚Äì Boutique en ligne s√©curis√©e
    </h1>
    <p class="visually-hidden">
        Offranel Shop est une boutique en ligne fiable proposant des articles certifi√©s,
        un suivi client via WhatsApp et une connexion s√©curis√©e par Google.
        Connectez-vous pour acc√©der √† votre espace client et passer vos commandes en toute s√©curit√©.
    </p>
</section>

<div class="row justify-content-center align-items-center mt-5 animate__animated animate__fadeIn">
    <div class="col-md-5">
        <article class="glass-card p-5 bg-white shadow-lg text-center"
                 style="border-radius: 30px; border: 1px solid rgba(255,107,0,0.1);"
                 aria-labelledby="login-title">

            <div class="mb-4">
                <div class="d-inline-block p-4 rounded-circle bg-light mb-3">
                    <i class="fas fa-shopping-bag fa-3x text-orange" aria-hidden="true"></i>
                </div>
            </div>

            <h2 id="login-title" class="fw-bold mb-2">
                Offranel Shop üçä
            </h2>

            <p class="text-muted mb-3">
                Votre boutique en ligne de confiance pour acheter des produits certifi√©s,
                profiter d‚Äôun service client r√©actif et suivre vos commandes facilement.
            </p>

            <p class="small text-muted mb-4">
                Connectez-vous pour acc√©der √† votre espace personnel, g√©rer vos commandes,
                d√©couvrir nos nouvelles offres et b√©n√©ficier d‚Äôune exp√©rience d‚Äôachat s√©curis√©e.
            </p>

            <div class="alert alert-info py-2 rounded-pill border-0 small mb-4"
                 style="background-color: rgba(24, 119, 242, 0.1); color: #1877F2;">
                <i class="fas fa-shield-alt me-2"></i>
                Connexion s√©curis√©e via Google ‚Äì rapide et prot√©g√©e
            </div>

            <button id="googleBtn"
                    class="btn btn-dark w-100 py-3 rounded-pill fw-bold shadow-sm
                           d-flex align-items-center justify-content-center transition-all"
                    aria-label="Se connecter avec Google sur Offranel Shop">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"
                     width="20"
                     alt="Logo Google"
                     class="me-3">
                Continuer avec Google
            </button>

            <div class="mt-4 pt-3 border-top">
                <p class="small text-muted mb-0">
                    En vous connectant, vous acceptez nos conditions et notre politique de confidentialit√©.
                </p>
                <a href="/a-propos"
                   class="small text-orange text-decoration-none fw-bold">
                    Conditions d'utilisation & √Ä propos
                </a>
            </div>
        </article>

        <section class="row mt-4 text-center g-3" aria-label="Avantages Offranel Shop">
            <div class="col-4">
                <i class="fas fa-check-circle text-orange mb-1"></i>
                <p class="small text-muted" style="font-size: 0.7rem;">
                    Articles Certifi√©s & Qualit√© garantie
                </p>
            </div>
            <div class="col-4">
                <i class="fas fa-truck text-orange mb-1"></i>
                <p class="small text-muted" style="font-size: 0.7rem;">
                    Livraison suivie et assistance WhatsApp
                </p>
            </div>
            <div class="col-4">
                <i class="fas fa-lock text-orange mb-1"></i>
                <p class="small text-muted" style="font-size: 0.7rem;">
                    Paiements et donn√©es 100% s√©curis√©s
                </p>
            </div>
        </section>
    </div>
</div>

<!-- Fallback SEO sans JavaScript -->
<noscript>
    <div class="container mt-4">
        <p class="text-muted small">
            Offranel Shop est une boutique en ligne s√©curis√©e.
            Pour vous connecter et acc√©der √† votre espace client,
            veuillez activer JavaScript dans votre navigateur.
        </p>
    </div>
</noscript>

<div id="authLoader"
     class="d-none position-fixed top-0 start-0 w-100 h-100 d-flex flex-column
            justify-content-center align-items-center bg-white opacity-75"
     style="z-index: 9999;">
    <div class="spinner-border text-orange" role="status"></div>
    <p class="mt-3 fw-bold text-orange">
        V√©rification s√©curis√©e de votre compte en cours...
    </p>
</div>

<!-- Donn√©es structur√©es Google -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "OnlineStore",
  "name": "Offranel Shop",
  "description": "Boutique en ligne s√©curis√©e proposant des articles certifi√©s, un suivi client WhatsApp et une connexion rapide via Google.",
  "url": "{{ request.url }}",
  "image": "/static/logo.png",
  "sameAs": [],
  "paymentAccepted": "Online Payment",
  "currenciesAccepted": "USD, CDF"
}
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDp2Wbtj_pUEmeH6B7DKQlOAzaW00jr1dE",
    authDomain: "malaki-offranel.firebaseapp.com",
    projectId: "malaki-offranel",
    storageBucket: "firebasestorage.app",
    appId: "1:255909746580:web:5b97ab8194520bf783a181"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  document.getElementById('googleBtn').onclick = async () => {
    const loader = document.getElementById('authLoader');
    loader.classList.remove('d-none');

    try {
        const result = await signInWithPopup(auth, provider);
        const response = await fetch('/set_session', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                uid: result.user.uid,
                name: result.user.displayName,
                email: result.user.email,
                photo: result.user.photoURL
            })
        });

        if(response.ok) {
            window.location.href = "/";
        }
    } catch (e) {
        loader.classList.add('d-none');
        alert("Erreur de connexion : " + e.message);
    }
  };
</script>

<style>
    .text-orange { color: #FF6B00 !important; }
    .bg-orange { background-color: #FF6B00 !important; }
    .btn-dark:hover { background-color: #333; transform: translateY(-2px); }
    .transition-all { transition: all 0.3s ease; }
    .glass-card { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.95); }
</style>
{% endblock %}
