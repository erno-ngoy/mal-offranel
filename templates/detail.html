{% extends 'base.html' %}
{% block content %}
<div class="container mt-4 animate__animated animate__fadeIn">
    <div class="row p-4 bg-white rounded-5 shadow border-orange position-relative overflow-hidden">

        {% if product.in_stock == False %}
        <div class="position-absolute top-0 end-0 bg-danger text-white px-5 py-2 fw-bold shadow" style="transform: rotate(45deg) translate(35px, -15px); z-index: 10;">
            VENDU
        </div>
        {% endif %}

        <div class="col-md-6 text-center">
            <div class="main-image-container mb-3">
                <img id="mainImage" src="{{ product.images[0] if product.images else product.photo_url }}"
                     class="img-fluid rounded-4 shadow-sm w-100"
                     style="max-height: 500px; object-fit: cover; cursor: zoom-in;">
            </div>

            {% if product.images and product.images|length > 1 %}
            <div class="d-flex gap-2 overflow-auto pb-2 justify-content-center">
                {% for img in product.images %}
                <img src="{{ img }}" class="rounded-3 border thumbnail-img"
                     style="width: 70px; height: 70px; object-fit: cover; cursor: pointer;"
                     onclick="document.getElementById('mainImage').src = this.src">
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <div class="col-md-6 mt-4 mt-md-0">
            <div class="d-flex align-items-center mb-3 p-2 bg-light rounded-pill d-inline-flex px-3">
                <img src="{{ product.author_photo if product.author_photo else 'https://ui-avatars.com/api/?name=' ~ product.author_name }}"
                     class="rounded-circle me-2" width="30" height="30">
                <span class="small fw-bold">{{ product.author_name if product.author_name else 'Offranel Admin' }}</span>
                <i class="fas fa-check-circle text-primary ms-1 small" title="Vendeur Certifi√©"></i>
            </div>

            <h1 class="fw-bold text-orange mb-1">{{ product.title }}</h1>
            <p class="text-muted small mb-3">Cat√©gorie : <span class="badge bg-light text-dark">{{ product.category if product.category else 'G√©n√©ral' }}</span></p>

            <h2 class="fw-bold mb-4">
                {{ product.price }}
                <span class="fs-5 text-muted">{{ product.currency }}</span>
            </h2>

            <hr>

            <h5 class="fw-bold"><i class="fas fa-align-left me-2 text-orange"></i>Description de l'article</h5>
            <p class="text-secondary" style="font-size: 1.1rem; line-height: 1.6;">
                {{ product.description if product.description else "Aucune description d√©taill√©e n'est disponible pour cet article." }}
            </p>

            <div class="mt-5 d-grid gap-2">
                {% if product.in_stock != False %}
                <button onclick="addToCart('{{ product.id }}', '{{ product.title }}', '{{ product.price }}', '{{ product.currency }}', '{{ product.images[0] if product.images else product.photo_url }}')"
                        class="btn btn-dark btn-lg rounded-pill fw-bold py-3 mb-2">
                    <i class="fas fa-cart-plus me-2"></i>Ajouter au panier
                </button>

                <a href="https://wa.me/243828035654?text=Bonjour Offranel üçä,%20je%20suis%20int√©ress√©%20par%20l'article%20:%20*{{ product.title }}*%0ALien: {{ request.url }}"
                   target="_blank" class="btn btn-orange btn-lg rounded-pill shadow py-3 fw-bold">
                   <i class="fab fa-whatsapp me-2"></i>Commander sur WhatsApp
                </a>
                {% else %}
                <button class="btn btn-secondary btn-lg rounded-pill py-3 fw-bold" disabled>CET ARTICLE EST √âPUIS√â</button>
                {% endif %}

                <a href="/" class="btn btn-outline-secondary rounded-pill mt-3">
                    <i class="fas fa-arrow-left me-2"></i>Retour au catalogue
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function addToCart(id, title, price, currency, image) {
    let cart = JSON.parse(localStorage.getItem('offranel_cart')) || [];
    const exists = cart.find(item => item.id === id);
    if (exists) {
        alert("Cet article est d√©j√† dans votre panier ! üçä");
        return;
    }
    cart.push({ id, title, price, currency, image });
    localStorage.setItem('offranel_cart', JSON.stringify(cart));
    if (typeof updateCartBadge === "function") { updateCartBadge(); }
    alert("Produit ajout√© ! Retrouvez-le dans votre panier. üçä");
}
</script>

<style>
    .border-orange { border: 2px solid rgba(255, 107, 0, 0.2); transition: 0.3s; }
    .border-orange:hover { border-color: #FF6B00; }
    .text-orange { color: #FF6B00; }
    .btn-orange { background-color: #FF6B00; color: white; border: none; }
    .btn-orange:hover { background-color: #e65a00; color: white; transform: translateY(-2px); }
    .thumbnail-img { transition: 0.2s; opacity: 0.6; }
    .thumbnail-img:hover { opacity: 1; border-color: #FF6B00 !important; }
    .main-image-container { overflow: hidden; border-radius: 1rem; }
    #mainImage { transition: transform 0.5s ease; }
    #mainImage:hover { transform: scale(1.05); }
    .text-primary { color: #1877F2 !important; }
</style>
{% endblock %}